environments:
  your-tenant-alias:
    values:
      - ../defaults/01_system.defaults.yaml
      - ../defaults/10_document_chat.defaults.yaml
      - ../defaults/50_confluence_connector.defaults.yaml
      - ./your-tenant-alias.yaml
---
releases:
  - name: confluence-connector
    chart: oci://ghcr.io/unique-ag/helm-charts/backend-service
    version: 6.1.0
    namespace: apps
    createNamespace: true
    wait: false
    values:
      -
        image:
          repository: uniquecr.azurecr.io/confluence-connector
          tag: {{ .Values.confluenceConnector.tenantReleaseOverrides.confluenceConnector | default .Values.confluenceConnector.defaultReleases.confluenceConnector }}
        replicaCount: {{ .Values.confluenceConnector | get "replicaCount" 1 }}
        imagePullSecrets:
          - name: image-pull-secret
        service:
          enabled: false
        env:
          PORT: 8080
          CONFLUENCE_TOKENS_PER_MINUTE: {{ .Values.confluenceConnector.env.CONFLUENCE_TOKENS_PER_MINUTE }}
          CONFLUENCE_URL: {{ .Values.confluenceConnector.env.CONFLUENCE_URL }}
          CRON_SCHEDULE: "0 0 * * *"
          INGEST_SINGLE_LABEL: {{ .Values.confluenceConnector.env.INGEST_SINGLE_LABEL }}
          INGEST_ALL_LABEL: {{ .Values.confluenceConnector.env.INGEST_ALL_LABEL }}
          UNIQUE_INGESTION_URL: http://node-ingestion.chat.svc.cluster.local:8091/v1/content
          ZITADEL_OAUTH_TOKEN_URL: https://{{ .Values.zitadel.hostName }}/oauth/v2/token
          ZITADEL_PROJECT_ID: {{ .Values.zitadel.projectId | quote }}
          TEST_MODE: {{ .Values.confluenceConnector.env.TEST_MODE }}
          DEBUG_MODE: {{ .Values.confluenceConnector.env.DEBUG_MODE }}
          SCOPE_ID: {{ .Values.confluenceConnector.env.SCOPE_ID }}
        envSecrets:
          ZITADEL_CLIENT_ID: {{ .Values.confluenceConnector.secrets.ZITADEL_CLIENT_ID | fetchSecretValue | quote }}
          ZITADEL_CLIENT_SECRET: {{ .Values.confluenceConnector.secrets.ZITADEL_CLIENT_SECRET | fetchSecretValue | quote }}
          CONFLUENCE_USERNAME: {{ .Values.confluenceConnector.secrets.CONFLUENCE_USERNAME | fetchSecretValue | quote }}
          CONFLUENCE_PASSWORD: {{ .Values.confluenceConnector.secrets.CONFLUENCE_PASSWORD | fetchSecretValue | quote }}
          CONFLUENCE_PAT: {{ .Values.confluenceConnector.secrets.CONFLUENCE_PAT | fetchSecretValue | quote }}